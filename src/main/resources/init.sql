SET DATABASE DEFAULT TABLE TYPE MEMORY;

CREATE TABLE IF NOT EXISTS PUBLIC.USERS(
USER_ID BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
USER_EMAIL VARCHAR(255) NOT NULL,
USER_ENABLED BOOLEAN NOT NULL,
USER_PASSWORD VARCHAR(255),
USER_NAME VARCHAR(255) NOT NULL,
CONSTRAINT UK_USERS_EMAIL UNIQUE(USER_EMAIL)
);

CREATE TABLE IF NOT EXISTS PUBLIC.DISKS(
DISK_ID BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
DISK_TITLE VARCHAR(255) NOT NULL,
DISK_HOLDER BIGINT NOT NULL,
DISK_OWNER BIGINT NOT NULL,
DISK_REQUEST BIGINT,
CONSTRAINT FK_DISKS_HOLDER FOREIGN KEY(DISK_HOLDER) REFERENCES PUBLIC.USERS(USER_ID),
CONSTRAINT FK_DISKS_OWNER FOREIGN KEY(DISK_OWNER) REFERENCES PUBLIC.USERS(USER_ID)
);

CREATE TABLE IF NOT EXISTS PUBLIC.REQUESTS(
REQ_ID BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
REQ_STATUS VARCHAR(255) NOT NULL,
REQ_DISK BIGINT,
REQ_USER BIGINT,
CONSTRAINT FK_REQUESTS_DISK FOREIGN KEY(REQ_DISK) REFERENCES PUBLIC.DISKS(DISK_ID),
CONSTRAINT FK_REQUESTS_USER FOREIGN KEY(REQ_USER) REFERENCES PUBLIC.USERS(USER_ID),
CONSTRAINT UK_REQUESTS_USER_DISK UNIQUE(REQ_USER,REQ_DISK)
);

CREATE TABLE IF NOT EXISTS PUBLIC.TAKENITEMS(
TI_ID BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
TI_DATE TIMESTAMP,
TI_DISK BIGINT,
TI_OWNER BIGINT,
TI_USER BIGINT,
CONSTRAINT FK_TAKENITEMS_DISK FOREIGN KEY(TI_DISK) REFERENCES PUBLIC.DISKS(DISK_ID),
CONSTRAINT FK_TAKENITEMS_OWNER FOREIGN KEY(TI_OWNER) REFERENCES PUBLIC.USERS(USER_ID),
CONSTRAINT FK_TAKENITEMS_USER FOREIGN KEY(TI_USER) REFERENCES PUBLIC.USERS(USER_ID),
CONSTRAINT UK_TAKENITEMS_USER_DISK UNIQUE(TI_USER,TI_DISK)
);

ALTER TABLE PUBLIC.DISKS ADD CONSTRAINT FK_DISKS_REQUEST FOREIGN KEY(DISK_REQUEST) REFERENCES PUBLIC.REQUESTS(REQ_ID);